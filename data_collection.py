import requests
import json
from datetime import datetime, timedelta

def fetch_cve_data():
    base_url = "https://services.nvd.nist.gov/rest/json/cves/2.0"
    
    # Define the end date as 05-01-2024
    end_date = datetime(2024, 5, 1, 23, 59, 59)
    
    # Calculate the start date 120 days before 
    start_date = end_date - timedelta(days=120)
    
    # Format the dates in the required ISO-8601 
    start_date_str = start_date.strftime('%Y-%m-%dT%H:%M:%S') + 'Z'
    end_date_str = end_date.strftime('%Y-%m-%dT%H:%M:%S') + 'Z'
    
    # Construct the URL
    url = f"{base_url}/?lastModStartDate={start_date_str}&lastModEndDate={end_date_str}"
    
    try:
        response = requests.get(url)
        response.raise_for_status()  # Raise an exception for HTTP errors
        data = response.json()
        
        # Process the retrieved data
        
        # Save the data to a JSON file
        with open('cve_data.json', 'w') as f:
            json.dump(data, f)
            print("Data saved successfully.")

    except requests.RequestException as e:
        print(f"Error fetching data: {e}")

if __name__ == "__main__":
    fetch_cve_data()
